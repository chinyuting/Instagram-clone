import{r as l,o as M,a,c as n,b as e,d as O,w as G,e as A,f as I,t as z,F as L,n as W,g as w,h as D,i as F,j as q,v as H,u as J,k as S,l as R,m as K}from"./index-9hbt1i1R.js";import{r as E,d as P,u as Q,M as U,o as N,_ as X}from"./navComponent-j0Ev2XY4.js";const Y={class:"rounded-circle story m-1 flex-shrink-0 p-1"},Z=["src"],ee={__name:"storyComponent",props:{ownerItem:Object},setup(x){const b=x,u=l(null),f=function(){if(u.value.getContext){const s=u.value.getContext("2d");s.beginPath();var i=s.createLinearGradient(0,0,175,0);i.addColorStop(0,"red"),i.addColorStop(.5,"yellow"),s.arc(39,39,36,0,2*Math.PI,!0),b.ownerItem.isWatched?s.fillStyle="rgb(224,224,224)":s.fillStyle=i,s.fill(),s.beginPath(),s.arc(39,39,34,0,2*Math.PI,!0),s.fillStyle="white",s.fill()}};return M(()=>{f()}),(i,s)=>(a(),n("div",null,[e("canvas",{width:"78",height:"78",ref_key:"canvas",ref:u,class:"position-absolute"},null,512),e("div",Y,[e("img",{src:x.ownerItem.user_media_url,alt:""},null,8,Z)])]))}},te=["id"],se={class:"card-header bg-body px-1 d-flex align-items-center px-2 px-md-0"},oe=e("div",{class:"rounded-circle user-pic"},null,-1),ae={class:"ms-2 fw-bold"},ne=["id","onDblclick"],le={key:0,class:"carousel-indicators"},ie=["data-bs-target","data-bs-slide-to","aria-current","aria-label"],re=["src"],ce=["data-bs-target"],de=e("span",{class:"carousel-control-prev-icon","aria-hidden":"true"},null,-1),ue=e("span",{class:"visually-hidden"},"Previous",-1),_e=[de,ue],me=["data-bs-target"],he=e("span",{class:"carousel-control-next-icon","aria-hidden":"true"},null,-1),ve=e("span",{class:"visually-hidden"},"Next",-1),pe=[he,ve],be={class:"card-body px-md-0 py-1 mb-3"},fe=["onClick"],ye={key:0,class:"bi bi-heart icon-size text-danger"},ge={key:1,class:"bi bi-heart-fill icon-size text-danger"},we={class:"card-text d-inline fw-bold"},xe={class:"card-text ms-2 d-inline"},ke=["onClick"],$e={key:0},Me={__name:"postComponent",props:{postDataList:Array},setup(x){const b=x,u=l(b.postDataList),f=O(()=>{const o=[...u.value];return o.sort((v,t)=>new Date(t.timestamp)-new Date(v.timestamp)),o});G(()=>b.postDataList,(o,v)=>{u.value=o});const i=l(new Set),s=o=>{i.value.has(o)?i.value.delete(o):i.value.add(o)},c=o=>i.value.has(o),d=(o,v)=>c(v)?o:o.slice(0,20),y=l(window.innerWidth>=768),C=()=>{y.value=window.innerWidth>=768};M(()=>{window.addEventListener("resize",C)}),A(()=>{window.removeEventListener("resize",C)});const k=function(o){o.isThumb=!o.isThumb;const v=E(P,`postsData/${o.key}`);Q(v,o).then(()=>{console.log("Data updated successfully!")}).catch(t=>{console.error("Error updating data:",t)})};return(o,v)=>(a(!0),n(L,null,I(f.value,(t,g)=>(a(),n("div",{class:"card mt-3 post-card w-100 border-0",key:t.id,id:t.id},[e("div",se,[oe,e("div",ae,z(t.username),1)]),e("div",{id:"post"+t.id,class:"carousel slide post-pic-area position-relative",onDblclick:h=>k(t)},[t.media_url.length>1?(a(),n("div",le,[(a(!0),n(L,null,I(t.media_url.length,(h,r)=>(a(),n("div",{key:r},[e("button",{class:W({active:r===0}),type:"button","data-bs-target":"#post"+t.id,"data-bs-slide-to":r,"aria-current":r===1,"aria-label":"Slide"+r},null,10,ie)]))),128))])):w("",!0),e("div",{class:"carousel-inner position-relative",ref_for:!0,ref:"postImg"},[(a(!0),n(L,null,I(t.media_url,(h,r)=>(a(),n("div",{class:W(["carousel-item",{active:r===0}]),key:r},[e("img",{src:h,class:"d-block w-100",alt:"..."},null,8,re)],2))),128))],512),t.media_url.length>1?(a(),n("button",{key:1,class:"carousel-control-prev",type:"button","data-bs-target":"#post"+t.id,"data-bs-slide":"prev"},_e,8,ce)):w("",!0),t.media_url.length>1?(a(),n("button",{key:2,class:"carousel-control-next",type:"button","data-bs-target":"#post"+t.id,"data-bs-slide":"next"},pe,8,me)):w("",!0)],40,ne),e("div",be,[e("a",{href:"",onClick:D(h=>k(t),["prevent"])},[t.isThumb?w("",!0):(a(),n("i",ye)),t.isThumb?(a(),n("i",ge)):w("",!0)],8,fe),e("div",null,[e("span",we,z(t.username),1),e("div",xe,z(d(t.caption,t.id)),1),!c(t.id)&&t.caption.length>20?(a(),n("a",{key:0,class:"text-decoration-none text-secondary fs-6",onClick:D(h=>s(t.id),["prevent"]),href:"#"}," ...更多 ",8,ke)):w("",!0)])]),g!=u.value.length-1&&y.value?(a(),n("hr",$e)):w("",!0)],8,te))),128))}},Ce={class:"modal-dialog modal-fullscreen-sm-down"},De={class:"modal-content bg-transparent b-0"},Te={class:"progress",style:{height:"2px"}},Le={class:"d-flex mt-2 justify-content-between align-items-center"},Ie=e("div",{class:"rounded-circle user-pic"},null,-1),Se={class:"text-light flex-grow-1 text-start ps-2"},ze={class:"rounded story-pic-area"},Oe=["src"],Ee={__name:"storyModalComponent",props:{storyOwner:Object},setup(x,{expose:b}){const u=l(null),f=l(null),i=l(0);let s=l(null),c=null;const d=function(){i.value=0,u.value.show(),c=new Date,y()},y=function(){s.value=setInterval(()=>{const g=new Date,h=t.value[0].duration;g-c>=h&&k();const r=Math.round((g-c)/h*100);i.value=r},100)},C=O(()=>({width:i.value+"%"})),k=function(){s.value&&clearInterval(s),u.value.hide()};b({showModal:d}),M(()=>{u.value=new U(f.value)});const o=x,v=l([]);M(()=>{const g=E(P,"storyData");N(g,h=>{const r=[];h.forEach(_=>{const m=_.key,p=_.val();r.push({key:m,...p})}),v.value=r})});const t=O(()=>v.value.filter(g=>g.storyownerid===o.storyOwner.id));return(g,h)=>(a(),n("div",{class:"modal fade custom-modal",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"storyModal",ref:f},[e("div",Ce,[e("div",De,[(a(!0),n(L,null,I(t.value,r=>(a(),n("div",{class:"modal-body text-end story-modal-body",key:r.id},[e("div",Te,[e("div",{class:"progress-bar",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:F(C.value)},null,4)]),e("div",Le,[Ie,e("div",Se,z(r.username),1),e("button",{type:"button",class:"btn-close btn-close-white position-relative","data-bs-dismiss":"modal","aria-label":"Close",onClick:D(k,["prevent"])})]),e("div",ze,[e("img",{src:r.media_url,class:"story-content-pic",alt:""},null,8,Oe)])]))),128))])])],512))}},Pe={class:"modal-dialog"},Ve={class:"modal-content"},je=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"請輸入密碼"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Re={class:"modal-body"},Be={class:"input-group mb-3"},Ne=e("span",{class:"input-group-text",id:"basic-addon1"},"密碼",-1),We={class:"modal-footer"},Fe=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1),Ue={__name:"getTokenModalComponent",setup(x,{expose:b}){const u=l(null),f=l(null);b({showModal:function(){u.value.show()}}),M(()=>{u.value=new U(f.value,{backdrop:"static",keyboard:!1})});const s=l("");return(c,d)=>(a(),n("div",{class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"getTokenModal",ref:f},[e("div",Pe,[e("div",Ve,[je,e("div",Re,[e("div",Be,[Ne,q(e("input",{type:"text",class:"form-control",placeholder:"client_secret","aria-label":"client_secret","aria-describedby":"basic-addon1","onUpdate:modelValue":d[0]||(d[0]=y=>s.value=y)},null,512),[[H,s.value]])])]),e("div",We,[Fe,e("button",{type:"button",class:"btn btn-primary",onClick:d[1]||(d[1]=D((...y)=>c.getToken&&c.getToken(...y),["prevent"]))},"確認")])])])],512))}},Ge={class:"row mx-0"},Ae={class:"col m-0 border-start min-vh-100"},qe={class:"stories position-relative w-md-75 mx-auto"},He=e("i",{class:"bi bi-arrow-left-circle-fill icon-size text-light"},null,-1),Je=[He],Ke=e("i",{class:"bi bi-arrow-right-circle-fill icon-size text-light"},null,-1),Qe=[Ke],Xe={class:"stories overflow-scroll flex-nowrap mt-md-2 position-relative"},Ye={class:"d-flex justify-content-start align-items-center"},Ze={class:"d-flex flex-column justify-content-center align-items-center mb-5"},$=3,B=78,st={__name:"MainView",setup(x){const b=l(null);let u=l({});const f=function(_){u.value=_,b.value.showModal()},i=l([]);M(()=>{const _=E(P,"storyOwner");N(_,m=>{const p=[];m.forEach(T=>{const V=T.key,j=T.val();p.push({key:V,...j})}),i.value=p})});let s=l(0),c=1,d=7,y=l(!1),C=l(i.value.length>d);const k=function(_){const m=i.value.length;m-d<$&&_===-1?(s.value+=_*(m-d)*B,c+=m-d,d+=m-d):c-$<0&&_===1?(s.value+=_*($-c)*B,d+=c-$,c+=c-$):(s.value+=_*$*B,c+=_*-$,d+=_*-$),y=l(c!==1),C=l(d<m)},o=O(()=>({transform:`translate(${s.value}px)`})),v=l([]);M(()=>{const _=E(P,"postsData");N(_,m=>{const p=[];m.forEach(T=>{const V=T.key,j=T.val();p.push({key:V,...j})}),v.value=p})});const t=l(null);J();let g=location.search.slice(6);const h=localStorage.getItem("access-token-expire-time");g?M(()=>{r()}):(!h||Date.now()>=parseInt(h,10))&&(window.location.href="https://api.instagram.com/oauth/authorize?client_id=461541476203224&redirect_uri=https://chinyuting.github.io/Instagram-Imitation/&scope=user_profile,user_media&response_type=code");const r=function(){t.value.showModal()};return(_,m)=>(a(),n(L,null,[e("div",Ge,[S(X),e("main",Ae,[e("div",qe,[R(y)?(a(),n("button",{key:0,type:"button",class:"position-absolute top-50 start-0 translate-middle-y btn stories-btn",onClick:m[0]||(m[0]=D(p=>k(1),["prevent"]))},Je)):w("",!0),R(C)?(a(),n("button",{key:1,type:"button",class:"position-absolute top-50 end-0 translate-middle-y btn stories-btn",onClick:m[1]||(m[1]=D(p=>k(-1),["prevent"]))},Qe)):w("",!0),e("div",Xe,[e("div",Ye,[(a(!0),n(L,null,I(i.value,p=>(a(),K(ee,{onClick:D(T=>f(p),["prevent"]),class:"storyComponent",key:p.id,ownerItem:p,style:F(o.value)},null,8,["onClick","ownerItem","style"]))),128))])])]),S(Ee,{ref_key:"storyModal",ref:b,storyOwner:R(u)},null,8,["storyOwner"]),e("div",Ze,[S(Me,{postDataList:v.value},null,8,["postDataList"])])])]),S(Ue,{ref_key:"getTokenModal",ref:t},null,512)],64))}};export{st as default};
