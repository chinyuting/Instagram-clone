import{x as O,r as l,j as C,o as S,y as j,a as c,c as d,b as e,m as k,_ as z,l as T,q as I,w as U,z as q,F as P,A as G,B as H,d as J,p as L,t as A,C as E,f as K}from"./index-nzbrbPh6.js";import{M as B,p as Q,g as W,f as X,b as Y,c as Z,e as ee,r as R,d as N,h as ae,u as te,o as se,_ as oe}from"./postComponent-TbwSLcl4.js";const le=O("postDataList",()=>{const i=l([]),p=l(!0),t=l(null);async function u(){const n=localStorage.getItem("long-lived-access-token");try{const a=await C.get(`https://cors-anywhere.herokuapp.com/https://graph.instagram.com/me/media?fields=caption,id,media_type,media_url,permalink,thumbnail_url,timestamp,username&access_token=${n}`);i.value=a.data.data,console.log("post",i.value),await Promise.all(i.value.map(async s=>{if(s.media_type==="CAROUSEL_ALBUM"){const y=await _(s.id);s.media_children=y}}))}catch(a){console.error(a),t.value=a}finally{p.value=!1}}async function _(n){const a=localStorage.getItem("long-lived-access-token");try{const s=await C.get(`https://cors-anywhere.herokuapp.com/https://graph.instagram.com/${n}/children?access_token=${a}`);return await Promise.all(s.data.data.map(async f=>await v(f.id)))}catch(s){return console.error(s),t.value=s,[]}}async function v(n){const a=localStorage.getItem("long-lived-access-token");try{return(await C.get(`https://cors-anywhere.herokuapp.com/https://graph.instagram.com/${n}?fields=id,media_type,media_url,permalink,thumbnail_url,timestamp,username&access_token=${a}`)).data.media_url}catch(s){return console.error(s),t.value=s,[]}}return{postData:i,getPostData:u}}),ne=e("button",{type:"button",class:"btn-close btn-close-white position-absolute top-0 end-0 m-3","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),ie={class:"modal-dialog modal-dialog-scrollable"},re={class:"modal-content"},ce={class:"modal-body"},de={__name:"profilePostModalComponent",props:{postId:String,postsData:Array},setup(i,{expose:p}){const t=l(null),u=l(null);p({showModal:function(){t.value.show()}}),S(()=>{t.value=new B(u.value)});const v=i,n=l(null);return j(()=>v.postId,a=>{n.value=a}),(a,s)=>(c(),d("div",{class:"modal fade custom-modal",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"profilePostModal",ref:u},[ne,e("div",ie,[e("div",re,[e("div",ce,[k(Q,{postDataList:i.postsData,postIdDirection:n.value},null,8,["postDataList","postIdDirection"])])])])],512))}},M=i=>(G("data-v-88b323c1"),i=i(),H(),i),ue=M(()=>e("button",{type:"button",class:"btn-close btn-close-white position-absolute top-0 end-0 m-3","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),me={class:"modal-content my-5"},pe={class:"modal-header d-flex justify-content-center"},_e=M(()=>e("h5",{class:"modal-title",id:"editUserImageModalLabel"},"更新使用者頭像",-1)),fe={class:"d-flex flex-sm-column flex-md-row"},he=M(()=>e("i",{class:"bi bi-image pic-icon"},null,-1)),ge=M(()=>e("span",null,"將相片和影片拖曳到這裡",-1)),ve=M(()=>e("label",{for:"file-input",class:"file-input-button btn btn-primary m-3"},"從電腦選擇",-1)),ye={key:1,class:"modal-body d-flex flex-column align-items-center input-img-area p-0"},be=["src"],De={__name:"editUserImageModalComponent",props:{userData:{type:Object,default:{}}},setup(i,{expose:p}){const t=l(!1),u=l(null),_=l(null),v=function(){u.value.show(),n()},n=()=>{a.value="",s.value=null};p({showModal:v}),S(()=>{u.value=new B(_.value)});const a=l(null),s=l(null),y=function(o){if(t.value=!0,o.files){s.value=o.files[0];let m=new FileReader;m.onload=g=>{a.value=g.target.result,t.value=!1},m.readAsDataURL(o.files[0])}},f=l(!1),$=o=>{o.dataTransfer.dropEffect="copy",f.value=!0,o.preventDefault()},h=o=>{f.value=!1,o.preventDefault()},b=o=>{o.preventDefault(),y(o.dataTransfer)},r=l(null),w=function(){V()},x=()=>{a.value=null},V=async()=>{t.value=!0;const o=s.value;if(!o){console.error("No file selected."),t.value=!1;return}const m=W(X),g=Y(m,"user/"+o.name);try{await Z(g,o);const D=await ee(g);if(D)F(D);else throw new Error("Fail to get imageUrl from storage")}catch(D){t.value=!1,console.error("Error uploading image:",D)}},F=function(o){const m=R(N,`userData/${userData.key}`);userData.media_url=o,ae(m,post).then(()=>{console.log("Data updated successfully!")}).catch(g=>{console.error("Error updating data:",g)}).finally(()=>{t.value=!1})};return(o,m)=>{const g=T("loading-overlay");return c(),d(P,null,[e("div",{class:"modal fade",id:"editUserImageModal",tabindex:"-1","aria-labelledby":"editUserImageModalLabel","aria-hidden":"true",ref_key:"editUserImageModal",ref:_},[ue,e("div",{class:"modal-dialog",ref_key:"modalDialog",ref:r},[e("div",me,[e("div",pe,[a.value?(c(),d("button",{key:0,class:"btn position-absolute start-0 mx-3 text-primary",onClick:x}," 上一步 ")):I("",!0),_e,a.value?(c(),d("button",{key:1,class:"btn position-absolute end-0 mx-3 text-primary",onClick:w}," 下一步 ")):I("",!0)]),e("div",fe,[a.value?(c(),d("div",ye,[e("img",{src:a.value,alt:"",class:"input-img"},null,8,be)])):(c(),d("div",{key:0,class:"modal-body align-items-center p-5",onDragover:U($,["prevent"]),onDragleave:U(h,["prevent"]),onDrop:U(b,["prevent"])},[e("div",{class:q(["d-flex flex-column align-items-center justify-content-center",f.value?"text-primary":""])},[he,ge,ve,e("input",{type:"file",id:"file-input",accept:"audio/*,video/*,image/*",onChange:m[0]||(m[0]=D=>y(D.target))},null,32)],2)],32))])])],512)],512),k(g,{active:t.value,"is-full-page":!0},null,8,["active"])],64)}}},we=z(De,[["__scopeId","data-v-88b323c1"]]),xe={class:"row mx-0"},ke={class:"col m-0 border-start min-vh-100"},Me={class:"profile mx-auto py-md-4 d-flex"},Ie={class:"rounded-circle profile-pic m-1 flex-shrink-0 p-1 my-auto"},$e=["src"],Ce={class:"align-self-center ms-md-5 ms-sm-2"},Ue={class:"d-flex my-1 align-self-center flex-column flex-md-row"},Le={class:"userName p-2 m-0"},Pe=e("div",{class:"p-2 cursor-pointer"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-gear-wide",viewBox:"0 0 16 16"},[e("path",{d:"M8.932.727c-.243-.97-1.62-.97-1.864 0l-.071.286a.96.96 0 0 1-1.622.434l-.205-.211c-.695-.719-1.888-.03-1.613.931l.08.284a.96.96 0 0 1-1.186 1.187l-.284-.081c-.96-.275-1.65.918-.931 1.613l.211.205a.96.96 0 0 1-.434 1.622l-.286.071c-.97.243-.97 1.62 0 1.864l.286.071a.96.96 0 0 1 .434 1.622l-.211.205c-.719.695-.03 1.888.931 1.613l.284-.08a.96.96 0 0 1 1.187 1.187l-.081.283c-.275.96.918 1.65 1.613.931l.205-.211a.96.96 0 0 1 1.622.434l.071.286c.243.97 1.62.97 1.864 0l.071-.286a.96.96 0 0 1 1.622-.434l.205.211c.695.719 1.888.03 1.613-.931l-.08-.284a.96.96 0 0 1 1.187-1.187l.283.081c.96.275 1.65-.918.931-1.613l-.211-.205a.96.96 0 0 1 .434-1.622l.286-.071c.97-.243.97-1.62 0-1.864l-.286-.071a.96.96 0 0 1-.434-1.622l.211-.205c.719-.695.03-1.888-.931-1.613l-.284.08a.96.96 0 0 1-1.187-1.186l.081-.284c.275-.96-.918-1.65-1.613-.931l-.205.211a.96.96 0 0 1-1.622-.434zM8 12.997a4.998 4.998 0 1 1 0-9.995 4.998 4.998 0 0 1 0 9.996z"})])],-1),Se={class:"my-1 d-flex list-unstyled align-self-center"},Ee={class:"media_count profile-data p-2"},Ae=e("span",null,"則貼文",-1),Be=e("li",{class:"media_count profile-data p-2"},[E("0"),e("span",null,"位粉絲")],-1),Re=e("li",{class:"media_count profile-data p-2"},[E("0"),e("span",null,"人追蹤中")],-1),Ne={class:"row mx-auto border-top"},Ve=["onClick"],Fe={class:"post-pic position-absolute w-100 h-100"},Oe=["src"],je=["src"],qe={__name:"ProfileView",setup(i){const p=le(),t=te(),u=async()=>{await t.getUserData(),await p.getPostData()},_=l([]),v=R(N,"postsData");S(async()=>{await u(),se(v,h=>{const b=[];h.forEach(r=>{const w=r.key,x=r.val();t.userData.username===x.username&&b.push({key:w,...x})}),_.value=b})});const n=J(()=>[...p.postData,..._.value].sort((b,r)=>new Date(r.timestamp)-new Date(b.timestamp))),a=l(null),s=l(""),y=function(h){s.value=h,a.value.showModal()},f=l(null),$=function(h){f.value.showModal()};return(h,b)=>(c(),d(P,null,[e("div",xe,[k(oe),e("main",ke,[e("div",Me,[e("div",Ie,[e("img",{src:L(t).userData.media_url,alt:""},null,8,$e)]),e("div",Ce,[e("div",Ue,[e("h4",Le,A(L(t).userData.username),1),e("div",{class:"d-flex flex-row"},[e("button",{class:"btn btn-light",type:"button",onClick:$}," 編輯個人檔案 "),Pe])]),e("ul",Se,[e("li",Ee,[E(A(n.value.length),1),Ae]),Be,Re])])]),e("article",Ne,[(c(!0),d(P,null,K(n.value,(r,w)=>(c(),d("div",{class:"mt-1 col-4 px-0 ps-1",key:w},[e("div",{class:"profile-post",onClick:x=>y(r.id)},[e("div",Fe,[r.media_type==="IMAGE"||r.media_type==="CAROUSEL_ALBUM"?(c(),d("img",{key:0,src:r.media_url,alt:""},null,8,Oe)):I("",!0),r.media_type==="VIDEO"?(c(),d("img",{key:1,src:r.thumbnail_url,alt:""},null,8,je)):I("",!0)])],8,Ve)]))),128))])])]),k(de,{postId:s.value,postsData:n.value,ref_key:"profilePostModal",ref:a},null,8,["postId","postsData"]),k(we,{ref_key:"editUserImageModal",ref:f,userData:L(t).userData},null,8,["userData"])],64))}};export{qe as default};
