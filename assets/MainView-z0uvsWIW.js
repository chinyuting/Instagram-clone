import{r as l,o as C,a,c as n,b as e,d as E,w as q,e as G,f as L,t as z,F as I,n as W,g as k,h as T,i as F,j as A,v as H,u as J,k as S,l as j,m as K}from"./index-iIgF4xCJ.js";import{r as O,d as P,u as Q,M as U,o as B,_ as X}from"./navComponent-WESxJj_-.js";const Y={class:"rounded-circle story m-1 flex-shrink-0 p-1"},Z=["src"],ee={__name:"storyComponent",props:{ownerItem:Object},setup($){const y=$,_=l(null),g=function(){if(_.value.getContext){const s=_.value.getContext("2d");s.beginPath();var i=s.createLinearGradient(0,0,175,0);i.addColorStop(0,"red"),i.addColorStop(.5,"yellow"),s.arc(39,39,36,0,2*Math.PI,!0),y.ownerItem.isWatched?s.fillStyle="rgb(224,224,224)":s.fillStyle=i,s.fill(),s.beginPath(),s.arc(39,39,34,0,2*Math.PI,!0),s.fillStyle="white",s.fill()}};return C(()=>{g()}),(i,s)=>(a(),n("div",null,[e("canvas",{width:"78",height:"78",ref_key:"canvas",ref:_,class:"position-absolute"},null,512),e("div",Y,[e("img",{src:$.ownerItem.user_media_url,alt:""},null,8,Z)])]))}},te=["id"],se={class:"card-header bg-body px-1 d-flex align-items-center px-2 px-md-0"},oe=e("div",{class:"rounded-circle user-pic"},null,-1),ae={class:"ms-2 fw-bold"},ne=["id","onDblclick"],le={key:0,class:"carousel-indicators"},ie=["data-bs-target","data-bs-slide-to","aria-current","aria-label"],re=["src"],ce=["data-bs-target"],de=e("span",{class:"carousel-control-prev-icon","aria-hidden":"true"},null,-1),ue=e("span",{class:"visually-hidden"},"Previous",-1),_e=[de,ue],me=["data-bs-target"],he=e("span",{class:"carousel-control-next-icon","aria-hidden":"true"},null,-1),pe=e("span",{class:"visually-hidden"},"Next",-1),ve=[he,pe],fe={class:"card-body px-md-0 py-1 mb-3"},be=["onClick"],ye={key:0,class:"bi bi-heart icon-size text-danger"},ge={key:1,class:"bi bi-heart-fill icon-size text-danger"},we={class:"card-text d-inline fw-bold"},xe={class:"card-text ms-2 d-inline"},ke=["onClick"],$e={key:0},Me={__name:"postComponent",props:{postDataList:Array},setup($){const y=$,_=l(y.postDataList),g=E(()=>{const o=[..._.value];return o.sort((c,t)=>new Date(t.timestamp)-new Date(c.timestamp)),o});q(()=>y.postDataList,(o,c)=>{_.value=o});const i=l(new Set),s=o=>{i.value.has(o)?i.value.delete(o):i.value.add(o)},r=o=>i.value.has(o),p=(o,c)=>r(c)?o:o.slice(0,20),x=l(window.innerWidth>=768),b=()=>{x.value=window.innerWidth>=768};C(()=>{window.addEventListener("resize",b)}),G(()=>{window.removeEventListener("resize",b)});const u=function(o){o.isThumb=!o.isThumb;const c=O(P,`postsData/${o.key}`);Q(c,o).then(()=>{console.log("Data updated successfully!")}).catch(t=>{console.error("Error updating data:",t)})};return(o,c)=>(a(!0),n(I,null,L(g.value,(t,w)=>(a(),n("div",{class:"card mt-3 post-card w-100 border-0",key:t.id,id:t.id},[e("div",se,[oe,e("div",ae,z(t.username),1)]),e("div",{id:"post"+t.id,class:"carousel slide post-pic-area position-relative",onDblclick:v=>u(t)},[t.media_url.length>1?(a(),n("div",le,[(a(!0),n(I,null,L(t.media_url.length,(v,d)=>(a(),n("div",{key:d},[e("button",{class:W({active:d===0}),type:"button","data-bs-target":"#post"+t.id,"data-bs-slide-to":d,"aria-current":d===1,"aria-label":"Slide"+d},null,10,ie)]))),128))])):k("",!0),e("div",{class:"carousel-inner position-relative",ref_for:!0,ref:"postImg"},[(a(!0),n(I,null,L(t.media_url,(v,d)=>(a(),n("div",{class:W(["carousel-item",{active:d===0}]),key:d},[e("img",{src:v,class:"d-block w-100",alt:"..."},null,8,re)],2))),128))],512),t.media_url.length>1?(a(),n("button",{key:1,class:"carousel-control-prev",type:"button","data-bs-target":"#post"+t.id,"data-bs-slide":"prev"},_e,8,ce)):k("",!0),t.media_url.length>1?(a(),n("button",{key:2,class:"carousel-control-next",type:"button","data-bs-target":"#post"+t.id,"data-bs-slide":"next"},ve,8,me)):k("",!0)],40,ne),e("div",fe,[e("a",{href:"",onClick:T(v=>u(t),["prevent"])},[t.isThumb?k("",!0):(a(),n("i",ye)),t.isThumb?(a(),n("i",ge)):k("",!0)],8,be),e("div",null,[e("span",we,z(t.username),1),e("div",xe,z(p(t.caption,t.id)),1),!r(t.id)&&t.caption.length>20?(a(),n("a",{key:0,class:"text-decoration-none text-secondary fs-6",onClick:T(v=>s(t.id),["prevent"]),href:"#"}," ...更多 ",8,ke)):k("",!0)])]),w!=_.value.length-1&&x.value?(a(),n("hr",$e)):k("",!0)],8,te))),128))}},Ce={class:"modal-dialog modal-fullscreen-sm-down"},Te={class:"modal-content bg-transparent b-0"},De={class:"progress",style:{height:"2px"}},Ie={class:"d-flex mt-2 justify-content-between align-items-center"},Le=e("div",{class:"rounded-circle user-pic"},null,-1),Se={class:"text-light flex-grow-1 text-start ps-2"},ze={class:"rounded story-pic-area"},Ee=["src"],Oe={__name:"storyModalComponent",props:{storyOwner:Object},setup($,{expose:y}){const _=l(null),g=l(null),i=l(0);let s=l(null),r=null;const p=function(){i.value=0,_.value.show(),r=new Date,x()},x=function(){s.value=setInterval(()=>{const w=new Date,v=t.value[0].duration;w-r>=v&&u();const d=Math.round((w-r)/v*100);i.value=d},100)},b=E(()=>({width:i.value+"%"})),u=function(){s.value&&clearInterval(s),_.value.hide()};y({showModal:p}),C(()=>{_.value=new U(g.value)});const o=$,c=l([]);C(()=>{const w=O(P,"storyData");B(w,v=>{const d=[];v.forEach(m=>{const h=m.key,f=m.val();d.push({key:h,...f})}),c.value=d})});const t=E(()=>c.value.filter(w=>w.storyownerid===o.storyOwner.id));return(w,v)=>(a(),n("div",{class:"modal fade custom-modal",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"storyModal",ref:g},[e("div",Ce,[e("div",Te,[(a(!0),n(I,null,L(t.value,d=>(a(),n("div",{class:"modal-body text-end story-modal-body",key:d.id},[e("div",De,[e("div",{class:"progress-bar",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:F(b.value)},null,4)]),e("div",Ie,[Le,e("div",Se,z(d.username),1),e("button",{type:"button",class:"btn-close btn-close-white position-relative","data-bs-dismiss":"modal","aria-label":"Close",onClick:T(u,["prevent"])})]),e("div",ze,[e("img",{src:d.media_url,class:"story-content-pic",alt:""},null,8,Ee)])]))),128))])])],512))}},Pe={class:"modal-dialog"},Re={class:"modal-content"},Ve=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"請輸入密碼")],-1),je={class:"modal-body"},Ne={class:"input-group mb-3"},Be=e("span",{class:"input-group-text",id:"basic-addon1"},"密碼",-1),We={class:"modal-footer"},Fe={__name:"getTokenModalComponent",setup($,{expose:y}){const _=l(null),g=l(null);y({showModal:function(){_.value.show()}}),C(()=>{_.value=new U(g.value,{backdrop:"static",keyboard:!1})});const s=l("");let r="";const p=()=>{if(location.search&&(r=location.search.slice(6),r)){const x=axios.create({headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[u=>qs.stringify(u)]});async function b(){try{const u=await x.post("https://cors-anywhere.herokuapp.com/https://api.instagram.com/oauth/access_token",{client_id:"461541476203224",client_secret:`${s.value}`,grant_type:"authorization_code",redirect_uri:"https://chinyuting.github.io/Instagram-Imitation/",code:`${r}`});console.log(u.data);let o=u.data.access_token;localStorage.setItem("user_id",u.data.user_id),o&&axios.get(`https://graph.instagram.com/access_token?grant_type=ig_exchange_token&client_secret=${s.value}&access_token=${o}`).then(c=>{console.log(c);const t=Date.now();expireTimestamp=c.data.expires_in+t,console.log(expireTimestamp,"expireTimestamp "),localStorage.setItem("long-lived-access-token",c.data.access_token),localStorage.setItem("access-token-expire-time",expireTimestamp.toString()),hideModal()}).catch(c=>{console.log(c)})}catch(u){console.error("Error:",u)}}b()}};return(x,b)=>(a(),n("div",{class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"getTokenModal",ref:g},[e("div",Pe,[e("div",Re,[Ve,e("div",je,[e("div",Ne,[Be,A(e("input",{type:"text",class:"form-control",placeholder:"client_secret","aria-label":"client_secret","aria-describedby":"basic-addon1","onUpdate:modelValue":b[0]||(b[0]=u=>s.value=u)},null,512),[[H,s.value]])])]),e("div",We,[e("button",{type:"button",class:"btn btn-primary",onClick:T(p,["prevent"])},"確認")])])])],512))}},Ue={class:"row mx-0"},qe={class:"col m-0 border-start min-vh-100"},Ge={class:"stories position-relative w-md-75 mx-auto"},Ae=e("i",{class:"bi bi-arrow-left-circle-fill icon-size text-light"},null,-1),He=[Ae],Je=e("i",{class:"bi bi-arrow-right-circle-fill icon-size text-light"},null,-1),Ke=[Je],Qe={class:"stories overflow-scroll flex-nowrap mt-md-2 position-relative"},Xe={class:"d-flex justify-content-start align-items-center"},Ye={class:"d-flex flex-column justify-content-center align-items-center mb-5"},M=3,N=78,tt={__name:"MainView",setup($){const y=l(null);let _=l({});const g=function(m){_.value=m,y.value.showModal()},i=l([]);C(()=>{const m=O(P,"storyOwner");B(m,h=>{const f=[];h.forEach(D=>{const R=D.key,V=D.val();f.push({key:R,...V})}),i.value=f})});let s=l(0),r=1,p=7,x=l(!1),b=l(i.value.length>p);const u=function(m){const h=i.value.length;h-p<M&&m===-1?(s.value+=m*(h-p)*N,r+=h-p,p+=h-p):r-M<0&&m===1?(s.value+=m*(M-r)*N,p+=r-M,r+=r-M):(s.value+=m*M*N,r+=m*-M,p+=m*-M),x=l(r!==1),b=l(p<h)},o=E(()=>({transform:`translate(${s.value}px)`})),c=l([]);C(()=>{const m=O(P,"postsData");B(m,h=>{const f=[];h.forEach(D=>{const R=D.key,V=D.val();f.push({key:R,...V})}),c.value=f})});const t=l(null);J();let w=location.search.slice(6);const v=localStorage.getItem("access-token-expire-time");w?C(()=>{d()}):(!v||Date.now()>=parseInt(v,10))&&(window.location.href="https://api.instagram.com/oauth/authorize?client_id=461541476203224&redirect_uri=https://chinyuting.github.io/Instagram-Imitation/&scope=user_profile,user_media&response_type=code");const d=function(){t.value.showModal()};return(m,h)=>(a(),n(I,null,[e("div",Ue,[S(X),e("main",qe,[e("div",Ge,[j(x)?(a(),n("button",{key:0,type:"button",class:"position-absolute top-50 start-0 translate-middle-y btn stories-btn",onClick:h[0]||(h[0]=T(f=>u(1),["prevent"]))},He)):k("",!0),j(b)?(a(),n("button",{key:1,type:"button",class:"position-absolute top-50 end-0 translate-middle-y btn stories-btn",onClick:h[1]||(h[1]=T(f=>u(-1),["prevent"]))},Ke)):k("",!0),e("div",Qe,[e("div",Xe,[(a(!0),n(I,null,L(i.value,f=>(a(),K(ee,{onClick:T(D=>g(f),["prevent"]),class:"storyComponent",key:f.id,ownerItem:f,style:F(o.value)},null,8,["onClick","ownerItem","style"]))),128))])])]),S(Oe,{ref_key:"storyModal",ref:y,storyOwner:j(_)},null,8,["storyOwner"]),e("div",Ye,[S(Me,{postDataList:c.value},null,8,["postDataList"])])])]),S(Fe,{ref_key:"getTokenModal",ref:t},null,512)],64))}};export{tt as default};
