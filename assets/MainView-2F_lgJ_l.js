import{r as n,o as D,a,c as l,b as e,d as O,w as H,e as J,f as S,t as E,F as T,n as U,g as k,h as M,i as F,j as q,v as A,u as K,k as z,l as N,m as Q}from"./index-qjbJxP33.js";import{r as V,d as P,u as X,M as G,o as W,_ as Y}from"./navComponent-9ypMgFqz.js";const Z={class:"rounded-circle story m-1 flex-shrink-0 p-1"},ee=["src"],te={__name:"storyComponent",props:{ownerItem:Object},setup($){const y=$,m=n(null),g=function(){if(m.value.getContext){const s=m.value.getContext("2d");s.beginPath();var r=s.createLinearGradient(0,0,175,0);r.addColorStop(0,"red"),r.addColorStop(.5,"yellow"),s.arc(39,39,36,0,2*Math.PI,!0),y.ownerItem.isWatched?s.fillStyle="rgb(224,224,224)":s.fillStyle=r,s.fill(),s.beginPath(),s.arc(39,39,34,0,2*Math.PI,!0),s.fillStyle="white",s.fill()}};return D(()=>{g()}),(r,s)=>(a(),l("div",null,[e("canvas",{width:"78",height:"78",ref_key:"canvas",ref:m,class:"position-absolute"},null,512),e("div",Z,[e("img",{src:$.ownerItem.user_media_url,alt:""},null,8,ee)])]))}},se=["id"],oe={class:"card-header bg-body px-1 d-flex align-items-center px-2 px-md-0"},ae=e("div",{class:"rounded-circle user-pic"},null,-1),ne={class:"ms-2 fw-bold"},le=["id","onDblclick"],ie={key:0,class:"carousel-indicators"},re=["data-bs-target","data-bs-slide-to","aria-current","aria-label"],ce=["src"],de=["data-bs-target"],ue=e("span",{class:"carousel-control-prev-icon","aria-hidden":"true"},null,-1),_e=e("span",{class:"visually-hidden"},"Previous",-1),me=[ue,_e],he=["data-bs-target"],pe=e("span",{class:"carousel-control-next-icon","aria-hidden":"true"},null,-1),ve=e("span",{class:"visually-hidden"},"Next",-1),be=[pe,ve],fe={class:"card-body px-md-0 py-1 mb-3"},ye=["onClick"],ge={key:0,class:"bi bi-heart icon-size text-danger"},we={key:1,class:"bi bi-heart-fill icon-size text-danger"},xe={class:"card-text d-inline fw-bold"},ke={class:"card-text ms-2 d-inline"},$e=["onClick"],Ce={key:0},Me={__name:"postComponent",props:{postDataList:Array},setup($){const y=$,m=n(y.postDataList),g=O(()=>{const o=[...m.value];return o.sort((d,t)=>new Date(t.timestamp)-new Date(d.timestamp)),o});H(()=>y.postDataList,(o,d)=>{m.value=o});const r=n(new Set),s=o=>{r.value.has(o)?r.value.delete(o):r.value.add(o)},c=o=>r.value.has(o),p=(o,d)=>c(d)?o:o.slice(0,20),x=n(window.innerWidth>=768),f=()=>{x.value=window.innerWidth>=768};D(()=>{window.addEventListener("resize",f)}),J(()=>{window.removeEventListener("resize",f)});const u=function(o){o.isThumb=!o.isThumb;const d=V(P,`postsData/${o.key}`);X(d,o).then(()=>{console.log("Data updated successfully!")}).catch(t=>{console.error("Error updating data:",t)})};return(o,d)=>(a(!0),l(T,null,S(g.value,(t,w)=>(a(),l("div",{class:"card mt-3 post-card w-100 border-0",key:t.id,id:t.id},[e("div",oe,[ae,e("div",ne,E(t.username),1)]),e("div",{id:"post"+t.id,class:"carousel slide post-pic-area position-relative",onDblclick:v=>u(t)},[t.media_url.length>1?(a(),l("div",ie,[(a(!0),l(T,null,S(t.media_url.length,(v,i)=>(a(),l("div",{key:i},[e("button",{class:U({active:i===0}),type:"button","data-bs-target":"#post"+t.id,"data-bs-slide-to":i,"aria-current":i===1,"aria-label":"Slide"+i},null,10,re)]))),128))])):k("",!0),e("div",{class:"carousel-inner position-relative",ref_for:!0,ref:"postImg"},[(a(!0),l(T,null,S(t.media_url,(v,i)=>(a(),l("div",{class:U(["carousel-item",{active:i===0}]),key:i},[e("img",{src:v,class:"d-block w-100",alt:"..."},null,8,ce)],2))),128))],512),t.media_url.length>1?(a(),l("button",{key:1,class:"carousel-control-prev",type:"button","data-bs-target":"#post"+t.id,"data-bs-slide":"prev"},me,8,de)):k("",!0),t.media_url.length>1?(a(),l("button",{key:2,class:"carousel-control-next",type:"button","data-bs-target":"#post"+t.id,"data-bs-slide":"next"},be,8,he)):k("",!0)],40,le),e("div",fe,[e("a",{href:"",onClick:M(v=>u(t),["prevent"])},[t.isThumb?k("",!0):(a(),l("i",ge)),t.isThumb?(a(),l("i",we)):k("",!0)],8,ye),e("div",null,[e("span",xe,E(t.username),1),e("div",ke,E(p(t.caption,t.id)),1),!c(t.id)&&t.caption.length>20?(a(),l("a",{key:0,class:"text-decoration-none text-secondary fs-6",onClick:M(v=>s(t.id),["prevent"]),href:"#"}," ...更多 ",8,$e)):k("",!0)])]),w!=m.value.length-1&&x.value?(a(),l("hr",Ce)):k("",!0)],8,se))),128))}},De={class:"modal-dialog modal-fullscreen-sm-down"},Ie={class:"modal-content bg-transparent b-0"},Te={class:"progress",style:{height:"2px"}},Le={class:"d-flex mt-2 justify-content-between align-items-center"},Se=e("div",{class:"rounded-circle user-pic"},null,-1),ze={class:"text-light flex-grow-1 text-start ps-2"},Ee={class:"rounded story-pic-area"},Oe=["src"],Ve={__name:"storyModalComponent",props:{storyOwner:Object},setup($,{expose:y}){const m=n(null),g=n(null),r=n(0);let s=n(null),c=null;const p=function(){r.value=0,m.value.show(),c=new Date,x()},x=function(){s.value=setInterval(()=>{const w=new Date,v=t.value[0].duration;w-c>=v&&u();const i=Math.round((w-c)/v*100);r.value=i},100)},f=O(()=>({width:r.value+"%"})),u=function(){s.value&&clearInterval(s),m.value.hide()};y({showModal:p}),D(()=>{m.value=new G(g.value)});const o=$,d=n([]);D(()=>{const w=V(P,"storyData");W(w,v=>{const i=[];v.forEach(L=>{const h=L.key,_=L.val();i.push({key:h,..._})}),d.value=i})});const t=O(()=>d.value.filter(w=>w.storyownerid===o.storyOwner.id));return(w,v)=>(a(),l("div",{class:"modal fade custom-modal",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"storyModal",ref:g},[e("div",De,[e("div",Ie,[(a(!0),l(T,null,S(t.value,i=>(a(),l("div",{class:"modal-body text-end story-modal-body",key:i.id},[e("div",Te,[e("div",{class:"progress-bar",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:F(f.value)},null,4)]),e("div",Le,[Se,e("div",ze,E(i.username),1),e("button",{type:"button",class:"btn-close btn-close-white position-relative","data-bs-dismiss":"modal","aria-label":"Close",onClick:M(u,["prevent"])})]),e("div",Ee,[e("img",{src:i.media_url,class:"story-content-pic",alt:""},null,8,Oe)])]))),128))])])],512))}},Pe={class:"modal-dialog"},Re={class:"modal-content"},je=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"請輸入密碼"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Ne={class:"modal-body"},Be={class:"input-group mb-3"},We=e("span",{class:"input-group-text",id:"basic-addon1"},"密碼",-1),Ue={class:"modal-footer"},Fe=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1),qe={__name:"getTokenModalComponent",setup($,{expose:y}){const m=n(null),g=n(null);y({showModal:function(){m.value.show()}}),D(()=>{m.value=new G(g.value,{backdrop:"static",keyboard:!1})});const s=n("");let c="";const p=()=>{if(location.search&&(c=location.search.slice(6),c)){const x=axios.create({headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[u=>qs.stringify(u)]});async function f(){try{const u=await x.post("https://cors-anywhere.herokuapp.com/https://api.instagram.com/oauth/access_token",{client_id:"461541476203224",client_secret:`${s.value}`,grant_type:"authorization_code",redirect_uri:"https://chinyuting.github.io/Instagram-Imitation/",code:`${c}`});console.log(u.data);let o=u.data.access_token;localStorage.setItem("user_id",u.data.user_id),o&&axios.get(`https://graph.instagram.com/access_token?grant_type=ig_exchange_token&client_secret=${s.value}&access_token=${o}`).then(d=>{console.log(d);const t=Date.now();expireTimestamp=d.data.expires_in+t,localStorage.setItem("long-lived-access-token",d.data.access_token),localStorage.setItem("access-token-expire-time",expireTimestamp.toString()),hideModal()}).catch(d=>{console.log(d)})}catch(u){console.error("Error:",u)}}f()}};return(x,f)=>(a(),l("div",{class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"getTokenModal",ref:g},[e("div",Pe,[e("div",Re,[je,e("div",Ne,[e("div",Be,[We,q(e("input",{type:"text",class:"form-control",placeholder:"client_secret","aria-label":"client_secret","aria-describedby":"basic-addon1","onUpdate:modelValue":f[0]||(f[0]=u=>s.value=u)},null,512),[[A,s.value]])])]),e("div",Ue,[Fe,e("button",{type:"button",class:"btn btn-primary",onClick:M(p,["prevent"])},"確認")])])])],512))}},Ae={class:"row mx-0"},Ge={class:"col m-0 border-start min-vh-100"},He={class:"stories position-relative w-md-75 mx-auto"},Je=e("i",{class:"bi bi-arrow-left-circle-fill icon-size text-light"},null,-1),Ke=[Je],Qe=e("i",{class:"bi bi-arrow-right-circle-fill icon-size text-light"},null,-1),Xe=[Qe],Ye={class:"stories overflow-scroll flex-nowrap mt-md-2 position-relative"},Ze={class:"d-flex justify-content-start align-items-center"},et={class:"d-flex flex-column justify-content-center align-items-center mb-5"},C=3,B=78,ot={__name:"MainView",setup($){const y=n(null);let m=n({});const g=function(h){m.value=h,y.value.showModal()},r=n([]);D(()=>{const h=V(P,"storyOwner");W(h,_=>{const b=[];_.forEach(I=>{const R=I.key,j=I.val();b.push({key:R,...j})}),r.value=b})});let s=n(0),c=1,p=7,x=n(!1),f=n(r.value.length>p);const u=function(h){const _=r.value.length;_-p<C&&h===-1?(s.value+=h*(_-p)*B,c+=_-p,p+=_-p):c-C<0&&h===1?(s.value+=h*(C-c)*B,p+=c-C,c+=c-C):(s.value+=h*C*B,c+=h*-C,p+=h*-C),x=n(c!==1),f=n(p<_)},o=O(()=>({transform:`translate(${s.value}px)`})),d=n([]);D(()=>{const h=V(P,"postsData");W(h,_=>{const b=[];_.forEach(I=>{const R=I.key,j=I.val();b.push({key:R,...j})}),d.value=b})});const t=n(null);K();let w=location.search.slice(6);const v=localStorage.getItem("access-token-expire-time");(!v||Date.now()>=parseInt(v,10)||!w)&&(window.location.href="https://api.instagram.com/oauth/authorize?client_id=461541476203224&redirect_uri=https://chinyuting.github.io/Instagram-Imitation/&scope=user_profile,user_media&response_type=code",L());const i=n(""),L=function(){t.value.showModal()};return(h,_)=>(a(),l(T,null,[e("div",Ae,[z(Y),e("main",Ge,[q(e("input",{type:"text","onUpdate:modelValue":_[0]||(_[0]=b=>i.value=b)},null,512),[[A,i.value]]),e("button",{type:"btn",onClick:L},"api"),e("div",He,[N(x)?(a(),l("button",{key:0,type:"button",class:"position-absolute top-50 start-0 translate-middle-y btn stories-btn",onClick:_[1]||(_[1]=M(b=>u(1),["prevent"]))},Ke)):k("",!0),N(f)?(a(),l("button",{key:1,type:"button",class:"position-absolute top-50 end-0 translate-middle-y btn stories-btn",onClick:_[2]||(_[2]=M(b=>u(-1),["prevent"]))},Xe)):k("",!0),e("div",Ye,[e("div",Ze,[(a(!0),l(T,null,S(r.value,b=>(a(),Q(te,{onClick:M(I=>g(b),["prevent"]),class:"storyComponent",key:b.id,ownerItem:b,style:F(o.value)},null,8,["onClick","ownerItem","style"]))),128))])])]),z(Ve,{ref_key:"storyModal",ref:y,storyOwner:N(m)},null,8,["storyOwner"]),e("div",et,[z(Me,{postDataList:d.value},null,8,["postDataList"])])])]),z(qe,{ref_key:"getTokenModal",ref:t},null,512)],64))}};export{ot as default};
