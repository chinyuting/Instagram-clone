import{x as I,r as n,j as y,o as P,y as $,a as u,c as m,b as a,m as w,d as C,p as b,t as k,z as D,F as x,f as L,q as M}from"./index-JD8BTwNI.js";import{M as S,p as E,u as V,r as A,o as B,d as U,_ as N}from"./postComponent-WmqEoShh.js";const F=I("postDataList",()=>{const c=n([]),i=n(!0),o=n(null);async function d(){const s=localStorage.getItem("long-lived-access-token");try{const e=await y.get(`https://cors-anywhere.herokuapp.com/https://graph.instagram.com/me/media?fields=caption,id,media_type,media_url,permalink,thumbnail_url,timestamp,username&access_token=${s}`);c.value=e.data.data,console.log("post",c.value),await Promise.all(c.value.map(async t=>{if(t.media_type==="CAROUSEL_ALBUM"){const f=await p(t.id);t.media_children=f}}))}catch(e){console.error(e),o.value=e}finally{i.value=!1}}async function p(s){const e=localStorage.getItem("long-lived-access-token");try{const t=await y.get(`https://cors-anywhere.herokuapp.com/https://graph.instagram.com/${s}/children?access_token=${e}`);return await Promise.all(t.data.data.map(async r=>await _(r.id)))}catch(t){return console.error(t),o.value=t,[]}}async function _(s){const e=localStorage.getItem("long-lived-access-token");try{return(await y.get(`https://cors-anywhere.herokuapp.com/https://graph.instagram.com/${s}?fields=id,media_type,media_url,permalink,thumbnail_url,timestamp,username&access_token=${e}`)).data.media_url}catch(t){return console.error(t),o.value=t,[]}}return{postData:c,getPostData:d}}),z=a("button",{type:"button",class:"btn-close btn-close-white position-absolute top-0 end-0 m-3","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),O={class:"modal-dialog modal-dialog-scrollable"},R={class:"modal-content"},j={class:"modal-body"},q={__name:"profilePostModalComponent",props:{postId:String,postsData:Array},setup(c,{expose:i}){const o=n(null),d=n(null);i({showModal:function(){o.value.show()}}),P(()=>{o.value=new S(d.value)});const _=c,s=n(null);return $(()=>_.postId,e=>{s.value=e}),(e,t)=>(u(),m("div",{class:"modal fade custom-modal",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"profilePostModal",ref:d},[z,a("div",O,[a("div",R,[a("div",j,[w(E,{postDataList:c.postsData,postIdDirection:s.value},null,8,["postDataList","postIdDirection"])])])])],512))}},G={class:"row mx-0"},T={class:"col m-0 border-start min-vh-100"},H={class:"profile mx-auto py-md-4 d-flex"},J={class:"rounded-circle profile-pic m-1 flex-shrink-0 p-1"},K=["src"],Q={class:"align-self-center ms-md-5 ms-sm-1"},W={class:"d-flex my-1 align-self-center flex-column"},X={class:"userName p-2"},Y=a("div",null,[a("button",{class:"btn btn-light",type:"button"},"編輯個人檔案"),a("div",{class:"p-2 cursor-pointer"},[a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-gear-wide",viewBox:"0 0 16 16"},[a("path",{d:"M8.932.727c-.243-.97-1.62-.97-1.864 0l-.071.286a.96.96 0 0 1-1.622.434l-.205-.211c-.695-.719-1.888-.03-1.613.931l.08.284a.96.96 0 0 1-1.186 1.187l-.284-.081c-.96-.275-1.65.918-.931 1.613l.211.205a.96.96 0 0 1-.434 1.622l-.286.071c-.97.243-.97 1.62 0 1.864l.286.071a.96.96 0 0 1 .434 1.622l-.211.205c-.719.695-.03 1.888.931 1.613l.284-.08a.96.96 0 0 1 1.187 1.187l-.081.283c-.275.96.918 1.65 1.613.931l.205-.211a.96.96 0 0 1 1.622.434l.071.286c.243.97 1.62.97 1.864 0l.071-.286a.96.96 0 0 1 1.622-.434l.205.211c.695.719 1.888.03 1.613-.931l-.08-.284a.96.96 0 0 1 1.187-1.187l.283.081c.96.275 1.65-.918.931-1.613l-.211-.205a.96.96 0 0 1 .434-1.622l.286-.071c.97-.243.97-1.62 0-1.864l-.286-.071a.96.96 0 0 1-.434-1.622l.211-.205c.719-.695.03-1.888-.931-1.613l-.284.08a.96.96 0 0 1-1.187-1.186l.081-.284c.275-.96-.918-1.65-1.613-.931l-.205.211a.96.96 0 0 1-1.622-.434zM8 12.997a4.998 4.998 0 1 1 0-9.995 4.998 4.998 0 0 1 0 9.996z"})])])],-1),Z={class:"my-1 d-flex list-unstyled align-self-center"},aa={class:"media_count profile-data p-2"},ta=a("span",null,"則貼文",-1),ea=a("li",{class:"media_count profile-data p-2"},[D("0"),a("span",null,"位粉絲")],-1),sa=a("li",{class:"media_count profile-data p-2"},[D("0"),a("span",null,"人追蹤中")],-1),oa={class:"row mx-auto border-top"},la=["onClick"],na={class:"post-pic position-absolute w-100 h-100"},ca=["src"],ra=["src"],ia=a("button",{class:"btn"},null,-1),ma={__name:"ProfileView",setup(c){const i=F(),o=V(),d=async()=>{await o.getUserData(),await i.getPostData()},p=n([]),_=A(U,"postsData");P(async()=>{await d(),B(_,r=>{const h=[];r.forEach(l=>{const g=l.key,v=l.val();o.userData.username===v.username&&h.push({key:g,...v})}),p.value=h})});const s=C(()=>[...i.postData,...p.value].sort((h,l)=>new Date(l.timestamp)-new Date(h.timestamp))),e=n(null),t=n(""),f=function(r){t.value=r,e.value.showModal()};return(r,h)=>(u(),m(x,null,[a("div",G,[w(N),a("main",T,[a("div",H,[a("div",J,[a("img",{src:b(o).userData.media_url,alt:""},null,8,K)]),a("div",Q,[a("div",W,[a("h4",X,k(b(o).userData.username),1),Y]),a("ul",Z,[a("li",aa,[D(k(s.value.length),1),ta]),ea,sa])])]),a("article",oa,[(u(!0),m(x,null,L(s.value,(l,g)=>(u(),m("div",{class:"mt-1 col-4 px-0 ps-1",key:g},[a("div",{class:"profile-post",onClick:v=>f(l.id)},[a("div",na,[l.media_type==="IMAGE"||l.media_type==="CAROUSEL_ALBUM"?(u(),m("img",{key:0,src:l.media_url,alt:""},null,8,ca)):M("",!0),l.media_type==="VIDEO"?(u(),m("img",{key:1,src:l.thumbnail_url,alt:""},null,8,ra)):M("",!0)])],8,la)]))),128))]),ia])]),w(q,{postId:t.value,postsData:s.value,ref_key:"profilePostModal",ref:e},null,8,["postId","postsData"])],64))}};export{ma as default};
