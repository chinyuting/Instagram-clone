import{r as i,o as D,a as n,c as l,b as e,d as z,w as U,e as q,f as T,t as S,F as I,n as B,g as x,h as C,i as W,j as A,v as G,u as H,k as L,l as V,m as J}from"./index-F5XULQXX.js";import{r as E,d as O,u as K,M as F,o as N,_ as Q}from"./navComponent-SmVn3HZD.js";const X={class:"rounded-circle story m-1 flex-shrink-0 p-1"},Y=["src"],Z={__name:"storyComponent",props:{ownerItem:Object},setup(k){const f=k,_=i(null),y=function(){if(_.value.getContext){const o=_.value.getContext("2d");o.beginPath();var r=o.createLinearGradient(0,0,175,0);r.addColorStop(0,"red"),r.addColorStop(.5,"yellow"),o.arc(39,39,36,0,2*Math.PI,!0),f.ownerItem.isWatched?o.fillStyle="rgb(224,224,224)":o.fillStyle=r,o.fill(),o.beginPath(),o.arc(39,39,34,0,2*Math.PI,!0),o.fillStyle="white",o.fill()}};return D(()=>{y()}),(r,o)=>(n(),l("div",null,[e("canvas",{width:"78",height:"78",ref_key:"canvas",ref:_,class:"position-absolute"},null,512),e("div",X,[e("img",{src:k.ownerItem.user_media_url,alt:""},null,8,Y)])]))}},ee=["id"],te={class:"card-header bg-body px-1 d-flex align-items-center px-2 px-md-0"},se=e("div",{class:"rounded-circle user-pic"},null,-1),oe={class:"ms-2 fw-bold"},ae=["id","onDblclick"],ne={key:0,class:"carousel-indicators"},le=["data-bs-target","data-bs-slide-to","aria-current","aria-label"],ie=["src"],re=["data-bs-target"],ce=e("span",{class:"carousel-control-prev-icon","aria-hidden":"true"},null,-1),de=e("span",{class:"visually-hidden"},"Previous",-1),ue=[ce,de],_e=["data-bs-target"],me=e("span",{class:"carousel-control-next-icon","aria-hidden":"true"},null,-1),he=e("span",{class:"visually-hidden"},"Next",-1),pe=[me,he],ve={class:"card-body px-md-0 py-1 mb-3"},be=["onClick"],fe={key:0,class:"bi bi-heart icon-size text-danger"},ye={key:1,class:"bi bi-heart-fill icon-size text-danger"},ge={class:"card-text d-inline fw-bold"},we={class:"card-text ms-2 d-inline"},xe=["onClick"],ke={key:0},$e={__name:"postComponent",props:{postDataList:Array},setup(k){const f=k,_=i(f.postDataList),y=z(()=>{const a=[..._.value];return a.sort((d,t)=>new Date(t.timestamp)-new Date(d.timestamp)),a});U(()=>f.postDataList,(a,d)=>{_.value=a});const r=i(new Set),o=a=>{r.value.has(a)?r.value.delete(a):r.value.add(a)},c=a=>r.value.has(a),h=(a,d)=>c(d)?a:a.slice(0,20),w=i(window.innerWidth>=768),b=()=>{w.value=window.innerWidth>=768};D(()=>{window.addEventListener("resize",b)}),q(()=>{window.removeEventListener("resize",b)});const u=function(a){a.isThumb=!a.isThumb;const d=E(O,`postsData/${a.key}`);K(d,a).then(()=>{console.log("Data updated successfully!")}).catch(t=>{console.error("Error updating data:",t)})};return(a,d)=>(n(!0),l(I,null,T(y.value,(t,g)=>(n(),l("div",{class:"card mt-3 post-card w-100 border-0",key:t.id,id:t.id},[e("div",te,[se,e("div",oe,S(t.username),1)]),e("div",{id:"post"+t.id,class:"carousel slide post-pic-area position-relative",onDblclick:p=>u(t)},[t.media_url.length>1?(n(),l("div",ne,[(n(!0),l(I,null,T(t.media_url.length,(p,s)=>(n(),l("div",{key:s},[e("button",{class:B({active:s===0}),type:"button","data-bs-target":"#post"+t.id,"data-bs-slide-to":s,"aria-current":s===1,"aria-label":"Slide"+s},null,10,le)]))),128))])):x("",!0),e("div",{class:"carousel-inner position-relative",ref_for:!0,ref:"postImg"},[(n(!0),l(I,null,T(t.media_url,(p,s)=>(n(),l("div",{class:B(["carousel-item",{active:s===0}]),key:s},[e("img",{src:p,class:"d-block w-100",alt:"..."},null,8,ie)],2))),128))],512),t.media_url.length>1?(n(),l("button",{key:1,class:"carousel-control-prev",type:"button","data-bs-target":"#post"+t.id,"data-bs-slide":"prev"},ue,8,re)):x("",!0),t.media_url.length>1?(n(),l("button",{key:2,class:"carousel-control-next",type:"button","data-bs-target":"#post"+t.id,"data-bs-slide":"next"},pe,8,_e)):x("",!0)],40,ae),e("div",ve,[e("a",{href:"",onClick:C(p=>u(t),["prevent"])},[t.isThumb?x("",!0):(n(),l("i",fe)),t.isThumb?(n(),l("i",ye)):x("",!0)],8,be),e("div",null,[e("span",ge,S(t.username),1),e("div",we,S(h(t.caption,t.id)),1),!c(t.id)&&t.caption.length>20?(n(),l("a",{key:0,class:"text-decoration-none text-secondary fs-6",onClick:C(p=>o(t.id),["prevent"]),href:"#"}," ...更多 ",8,xe)):x("",!0)])]),g!=_.value.length-1&&w.value?(n(),l("hr",ke)):x("",!0)],8,ee))),128))}},Me={class:"modal-dialog modal-fullscreen-sm-down"},Ce={class:"modal-content bg-transparent b-0"},De={class:"progress",style:{height:"2px"}},Ie={class:"d-flex mt-2 justify-content-between align-items-center"},Te=e("div",{class:"rounded-circle user-pic"},null,-1),Le={class:"text-light flex-grow-1 text-start ps-2"},Se={class:"rounded story-pic-area"},ze=["src"],Ee={__name:"storyModalComponent",props:{storyOwner:Object},setup(k,{expose:f}){const _=i(null),y=i(null),r=i(0);let o=i(null),c=null;const h=function(){r.value=0,_.value.show(),c=new Date,w()},w=function(){o.value=setInterval(()=>{const g=new Date,p=t.value[0].duration;g-c>=p&&u();const s=Math.round((g-c)/p*100);r.value=s},100)},b=z(()=>({width:r.value+"%"})),u=function(){o.value&&clearInterval(o),_.value.hide()};f({showModal:h}),D(()=>{_.value=new F(y.value)});const a=k,d=i([]);D(()=>{const g=E(O,"storyData");N(g,p=>{const s=[];p.forEach(m=>{const v=m.key,$=m.val();s.push({key:v,...$})}),d.value=s})});const t=z(()=>d.value.filter(g=>g.storyownerid===a.storyOwner.id));return(g,p)=>(n(),l("div",{class:"modal fade custom-modal",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"storyModal",ref:y},[e("div",Me,[e("div",Ce,[(n(!0),l(I,null,T(t.value,s=>(n(),l("div",{class:"modal-body text-end story-modal-body",key:s.id},[e("div",De,[e("div",{class:"progress-bar",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:W(b.value)},null,4)]),e("div",Ie,[Te,e("div",Le,S(s.username),1),e("button",{type:"button",class:"btn-close btn-close-white position-relative","data-bs-dismiss":"modal","aria-label":"Close",onClick:C(u,["prevent"])})]),e("div",Se,[e("img",{src:s.media_url,class:"story-content-pic",alt:""},null,8,ze)])]))),128))])])],512))}},Oe={class:"modal-dialog"},Pe={class:"modal-content"},Re=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"請輸入密碼"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Ve={class:"modal-body"},je={class:"input-group mb-3"},Ne=e("span",{class:"input-group-text",id:"basic-addon1"},"密碼",-1),Be={class:"modal-footer"},We=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1),Fe={__name:"getTokenModalComponent",setup(k,{expose:f}){const _=i(null),y=i(null);f({showModal:function(){_.value.show()}}),D(()=>{_.value=new F(y.value,{backdrop:"static",keyboard:!1})});const o=i("");let c="";const h=()=>{if(location.search&&(c=location.search.slice(6),c)){const w=axios.create({headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[u=>qs.stringify(u)]});async function b(){try{const u=await w.post("https://cors-anywhere.herokuapp.com/https://api.instagram.com/oauth/access_token",{client_id:"461541476203224",client_secret:`${o.value}`,grant_type:"authorization_code",redirect_uri:"https://chinyuting.github.io/Instagram-Imitation/",code:`${c}`});console.log(u.data);let a=u.data.access_token;localStorage.setItem("user_id",u.data.user_id),a&&axios.get(`https://graph.instagram.com/access_token?grant_type=ig_exchange_token&client_secret=${o.value}&access_token=${a}`).then(d=>{console.log(d);const t=Date.now();expireTimestamp=d.data.expires_in+t,localStorage.setItem("long-lived-access-token",d.data.access_token),localStorage.setItem("access-token-expire-time",expireTimestamp.toString()),hideModal()}).catch(d=>{console.log(d)})}catch(u){console.error("Error:",u)}}b()}};return(w,b)=>(n(),l("div",{class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"getTokenModal",ref:y},[e("div",Oe,[e("div",Pe,[Re,e("div",Ve,[e("div",je,[Ne,A(e("input",{type:"text",class:"form-control",placeholder:"client_secret","aria-label":"client_secret","aria-describedby":"basic-addon1","onUpdate:modelValue":b[0]||(b[0]=u=>o.value=u)},null,512),[[G,o.value]])])]),e("div",Be,[We,e("button",{type:"button",class:"btn btn-primary",onClick:C(h,["prevent"])},"確認")])])])],512))}},Ue={class:"row mx-0"},qe={class:"col m-0 border-start min-vh-100"},Ae={class:"stories position-relative w-md-75 mx-auto"},Ge=e("i",{class:"bi bi-arrow-left-circle-fill icon-size text-light"},null,-1),He=[Ge],Je=e("i",{class:"bi bi-arrow-right-circle-fill icon-size text-light"},null,-1),Ke=[Je],Qe={class:"stories overflow-scroll flex-nowrap mt-md-2 position-relative"},Xe={class:"d-flex justify-content-start align-items-center"},Ye={class:"d-flex flex-column justify-content-center align-items-center mb-5"},M=3,j=78,tt={__name:"MainView",setup(k){const f=i(null);let _=i({});const y=function(s){_.value=s,f.value.showModal()},r=i([]);D(()=>{const s=E(O,"storyOwner");N(s,m=>{const v=[];m.forEach($=>{const P=$.key,R=$.val();v.push({key:P,...R})}),r.value=v})});let o=i(0),c=1,h=7,w=i(!1),b=i(r.value.length>h);const u=function(s){const m=r.value.length;m-h<M&&s===-1?(o.value+=s*(m-h)*j,c+=m-h,h+=m-h):c-M<0&&s===1?(o.value+=s*(M-c)*j,h+=c-M,c+=c-M):(o.value+=s*M*j,c+=s*-M,h+=s*-M),w=i(c!==1),b=i(h<m)},a=z(()=>({transform:`translate(${o.value}px)`})),d=i([]);D(()=>{const s=E(O,"postsData");N(s,m=>{const v=[];m.forEach($=>{const P=$.key,R=$.val();v.push({key:P,...R})}),d.value=v})});const t=i(null);H();let g=location.search.slice(6);const p=localStorage.getItem("access-token-expire-time");return g?t.value.showModal():(!p||Date.now()>=parseInt(p,10))&&(window.location.href="https://api.instagram.com/oauth/authorize?client_id=461541476203224&redirect_uri=https://chinyuting.github.io/Instagram-Imitation/&scope=user_profile,user_media&response_type=code"),(s,m)=>(n(),l(I,null,[e("div",Ue,[L(Q),e("main",qe,[e("div",Ae,[V(w)?(n(),l("button",{key:0,type:"button",class:"position-absolute top-50 start-0 translate-middle-y btn stories-btn",onClick:m[0]||(m[0]=C(v=>u(1),["prevent"]))},He)):x("",!0),V(b)?(n(),l("button",{key:1,type:"button",class:"position-absolute top-50 end-0 translate-middle-y btn stories-btn",onClick:m[1]||(m[1]=C(v=>u(-1),["prevent"]))},Ke)):x("",!0),e("div",Qe,[e("div",Xe,[(n(!0),l(I,null,T(r.value,v=>(n(),J(Z,{onClick:C($=>y(v),["prevent"]),class:"storyComponent",key:v.id,ownerItem:v,style:W(a.value)},null,8,["onClick","ownerItem","style"]))),128))])])]),L(Ee,{ref_key:"storyModal",ref:f,storyOwner:V(_)},null,8,["storyOwner"]),e("div",Ye,[L($e,{postDataList:d.value},null,8,["postDataList"])])])]),L(Fe,{ref_key:"getTokenModal",ref:t},null,512)],64))}};export{tt as default};
